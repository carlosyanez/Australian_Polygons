lgas_list <- rbind(lgas_list,melb_lgas_list) %>% rbind(uninc_areas)
rm(regions,melb_lgas_list,wiki_page,uninc_areas)
#Download all shapefiles
shp_files <- tribble(~name,~filename,~url,
"LGA","VIC_LGA_POLYGON_SHP.shp","https://data.gov.au/data/dataset/bdf92691-c6fe-42b9-a0e2-a4cd716fa811/resource/7b6043d1-76b8-4ea9-b36b-51c61aa740d0/download/vic_lga_polygon_shp.zip",
"LOC","VIC_LOCALITY_POLYGON_SHP.shp","https://data.gov.au/data/dataset/af33dd8c-0534-4e18-9245-fc64440f742e/resource/3b946968-319e-4125-8971-2a33d5bf000c/download/vic_locality_polygon_shp.zip",
"POA","POA_2016_AUST.shp","https://www.abs.gov.au/ausstats/subscriber.nsf/log?openagent&1270055003_poa_2016_aust_shape.zip&1270.0.55.003&Data%20Cubes&4FB811FA48EECA7ACA25802C001432D0&0&July%202016&13.09.2016&Previous"
)
## download victorian shapfiles
shapes <- map(1:nrow(shp_files), function(x,shp_files){
if(!file.exists(shp_files[x,]$filename)){
download.file(shp_files[x.]$url,"temp.zip")
unzip("temp.zip")
file.remove("temp.zip")
}
st_read(shp_files[x,]$filename)
},shp_files)
names(shapes) <- shp_files %>% pull(name)
##alternative
vic_loc_lga_1 <- map_df(1:nrow(shapes$LGA),function(x,suburb_polygon,lga_polygon){
#message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
#message(nrow(a))
if(nrow(a)==0){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},shapes$LOC,shapes$LGA)
loc_count <- as.data.frame(vic_loc_lga_1) %>% select(-geometry) %>%
group_by(LOC_PID,LOCALITY) %>%
summarise(n=n(),relevant=sum(RELEVANT),.groups="drop") %>%
mutate(single_rel=(relevant==1),
diff=n-relevant) %>%
mutate(group=if_else(single_rel & (diff==0), "a","c"),    #ready to use
group=if_else(single_rel & !(diff==0), "b",group), #merge small pieces
group=if_else(!single_rel & (diff==0), "a",group)) #ready to use  # group c needs work
vic_loc_lga_1 <- vic_loc_lga_1 %>% left_join(loc_count %>% select(LOC_PID,group),by="LOC_PID")
#filter out a, filter and consolidate c
vic_loc_lga_a <- vic_loc_lga_1 %>% filter(group=="a") %>% select(-ROW_ID,-group,-RELEVANT,-AREA) %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_b <- vic_loc_lga_1 %>% filter(group=="b") %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_c <-  vic_loc_lga_1 %>% filter(group=="c") %>%
filter(AREA>area_tolerance2) %>%
select(-group,-AREA)
vic_loc_lga_c_rel <- vic_loc_lga_c %>% filter(RELEVANT) %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise() %>%
mutate(ROW_ID=10^4*row_number())
vic_loc_lga_c_irrel <- vic_loc_lga_c %>%
filter(!RELEVANT) %>%
mutate(ROW_ID=10^4*row_number()) %>%
select(-RELEVANT)
#nrow(vic_loc_lga_c_irrel) # equals 0, nothing else to do here
#left ROW_ID in case it is needed in other states
vic_loc_lga <- rbind(vic_loc_lga_a,vic_loc_lga_b) %>%
rbind(vic_loc_lga_c_rel %>% select(-ROW_ID)) %>%
left_join(lgas_list,by="LGA") %>%
mutate(State=State)
#clean up
rm(list=ls()[! ls() %in% c("vic_loc_lga","shapes","clean_lga")])
vic_loc_lga_poa1 <- map_df(1:nrow(shapes$POA),function(x,suburb_polygon,lga_polygon){
#message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
#message(nrow(a))
if(nrow(a)==0){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_loc_lga,shapes$POA)
shapes$POA
vic_state <- vic_loc_lga %>%
group_by(State) %>%
summarise()
vic_poa <- st_covered_by(shapes$POA,vic_state)
View(vic_poa)
View(vic_poa)
View(vic_poa)
vic_poa <- st_intersection(shapes$POA,vic_state)
View(vic_poa)
vic_poa
vic_poa <- shapes$POA %>% filter(POA_CODE_16 %in% vic_poa$POA_CODE16)
vic_poa <- shapes$POA %>% filter(POA_CODE16 %in% vic_poa$POA_CODE16)
vic_poa
vic_loc_lga_poa1 <- map_df(1:nrow(vic_poa),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(lga_loc_polygon,poa_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
mutate(ROW_ID=row_number()) %>%
select(ROW_ID,POA_CODE16,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_loc_lga,vic_poa)
area_tolerance <-set_units(10^4,m^2)
area_tolerance2 <-set_units(10^4,m^2)
vic_loc_lga_poa1 <- map_df(1:nrow(vic_poa),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(lga_loc_polygon,poa_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
mutate(ROW_ID=row_number()) %>%
select(ROW_ID,POA_CODE16,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_loc_lga,vic_poa)
vic_loc_lga_poa1 <- map_df(1:nrow(vic_poa),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(lga_loc_polygon,poa_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
mutate(ROW_ID=row_number()) %>%
select(POA_CODE16,colnames(lga_loc_polygon))
},vic_loc_lga,vic_poa)
vic_loc_lga_poa1 <- map_df(1:nrow(vic_poa),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(lga_loc_polygon,poa_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
mutate(ROW_ID=row_number()) %>%
select(ROW_ID,POA_CODE16,colnames(lga_loc_polygon),AREA)
},vic_loc_lga,vic_poa)
vic_loc_lga_poa1 <- map_df(1:nrow(vic_loc_lga),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(poa_polygon,lga_loc_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
mutate(ROW_ID=row_number()) %>%
select(ROW_ID,POA_CODE16,colnames(lga_loc_polygon),AREA)
},vic_loc_lga,vic_poa)
a <- st_intersection(vic_poa,vic_loc_lga[2634,]) %>%
st_collection_extract("POLYGON")
View(a)
vic_poa,vic_loc_lga[2634,]
vic_loc_lga[2634,]
vic_loc_lga[2634,]$LOCALITY
vic_loc_lga_poa1 <- map_df(1:nrow(vic_loc_lga),function(x,lga_loc_polygon,poa_polygon){
message(x)
a <- st_intersection(poa_polygon,lga_loc_polygon[x,]) %>%
st_collection_extract("POLYGON")
if(nrow(a)==0){
lga_loc_polygon[x,] %>% mutate(POA_CODE16="none",
AREA=st_area(.),
RELEVANT=TRUE)
}else{
message(nrow(a))
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
select(POA_CODE16,colnames(lga_loc_polygon),AREA)
}
},vic_loc_lga,vic_poa)
vic_loc_lga_poa1
vic_loc_lga_poa1
vic_loc_lga_poa1 %>% filter(POA_CODE16=="none")
vic_loc_lga_poa1 <- vic_loc_lga_poa1 %>% mutate(RELEVANT=(AREA>area_tolerance))
vic_loc_lga_poa1
vic_loc_lga_poa1 %>% filter(POA_CODE16=="none")
missing_poas <- tribble(~LOC_PID,~missinPOA,
"VIC2104","3965",
"VIC2305","3971",
"VIC2746","3966"
)
missing_poas <- tribble(~LOC_PID,~missingPOA,
"VIC2104","3965",
"VIC2305","3971",
"VIC2746","3966"
)
vic_loc_lga_poa1 <- vic_loc_lga_poa1 %>%
left_join(missing_poas,by="LOC_PID") %>%
mutate(POA_CODE16=if_else(POA_CODE16=="none",missingPOA,POA_CODE16)) %>%
select(-missingPOA)
vic_loc_lga_poa1 %>% filter(POA_CODE16=="none")
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
group_by(LOC_PID,POA_CODE16,LOCALITY)
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
group_by(LOC_PID,POA_CODE16,LOCALITY) %>%
summarise(n=n(),relevant=sum(RELEVANT),.groups="drop")
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
group_by(LOC_PID,POA_CODE16,LOCALITY) %>%
summarise(n=n(),relevant=sum(RELEVANT),.groups="drop") %>%
filter(relevant>0)
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LOCALTIY,POA_CODE16,AREA) %>%
group_by(LOC_PID,LOCALTIY) %>%
arrange(desc(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOC_PID=="VIC1001")
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOC_PID=="VIC1001") %>%
select(LOC_PID,LGA_PID,LOCALTIY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALTIY,LGA) %>%
arrange(desc(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOC_PID=="VIC1001") %>%
select(LOC_PID,LGA_PID,LOCALTIY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOC_PID=="VIC1001") %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOC_PID=="VIC1001") %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & grepl("Melbourne",LGA)) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA))
as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT & LOCALITY=="Melbourne") %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA))
area_tolerance3 <-set_units(0.2,1)
loc_lga_poa_table <- as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA)) %>%
filter(AREA_REL>=area_tolerance3)
View(loc_lga_poa_table)
area_tolerance3 <-set_units(0.4,1)
loc_lga_poa_table <- as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA)) %>%
filter(AREA_REL>=area_tolerance3)
loc_lga_poa_table
loc_lga_poa_table <- as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA)) %>%
filter(AREA_REL>=area_tolerance3) %>%
mutate(ROW_ID=row_number())
loc_lga_poa_table1
loc_lga_poa_table
loc_lga_poa_table1 <- loc_lga_poa_table %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16) %>%
summarise(n=n())
loc_lga_poa_table1 <- loc_lga_poa_table %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16) %>%
summarise(n=n(),.groups = "drop")
View(loc_lga_poa_table1)
loc_lga_poa_table1 <- loc_lga_poa_table %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
summarise(n=n(),.groups = "drop")
loc_lga_poa_table_a <-  lga_loc_polygon %>%
left_join (loc_lga_poa_table1 %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_a <-  vic_lga_loc_polygon %>%
left_join (loc_lga_poa_table1 %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_a <-  vic_loc_lga %>%
left_join (loc_lga_poa_table1 %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table1
loc_lga_poa_table <- loc_lga_poa_table %>%
left_join(loc_lga_poa_table1 %>% select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID"))
loc_lga_poa_table <- loc_lga_poa_table %>%
left_join(loc_lga_poa_table1 %>% select(LOC_PID,LGA_PID,n),
by=c("LOC_PID","LGA_PID"))
loc_lga_poa_table
loc_lga_poa_table_a <-  vic_loc_lga %>%
left_join (loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_a
loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16)
vic_loc_lga %>%
left_join (loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID"))
by=c("LOC_PID","LGA_PID"))
filter_a <- loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16)
filter_a <- loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16)
loc_lga_poa_table
loc_lga_poa_table <- as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA)) %>%
filter(AREA_REL>=area_tolerance3) %>%
mutate(ROW_ID=row_number()) %>%
ungroup()
loc_lga_poa_table1 <- loc_lga_poa_table %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
summarise(n=n(),.groups = "drop")
loc_lga_poa_table <- loc_lga_poa_table %>%
left_join(loc_lga_poa_table1 %>% select(LOC_PID,LGA_PID,n),
by=c("LOC_PID","LGA_PID"))
loc_lga_poa_table_a <-  vic_loc_lga %>%
left_join (loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_a
loc_lga_poa_table_b <- vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
filter(!(n==1)) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_b
vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
filter(!(n==1)) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID"))
vic_loc_lga_poa1
vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
select(LOC_PID,LGA_PID,POA_CODE16,n),
by=c("LOC_PID","LGA_PID","POA_CODE16")) %>%
filter(!(n==1))
loc_lga_poa_table_b <- vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
select(LOC_PID,LGA_PID,POA_CODE16,n),
by=c("LOC_PID","LGA_PID","POA_CODE16")) %>%
filter(!(n==1))
loc_lga_poa_table_b
#check all postcode combinations for manual correctios if necessary
loc_lga_poa_table_b %>% select(POA_CODE16,LOCALITY,RELEVANT) %>% unique(.)
loc_lga_poa_table_b %>% select(POA_CODE16,LOCALITY,RELEVANT) %>%
as.data.frame() %>%  select(-geometry) %>% unique(.)
loc_lga_poa_table_a
loc_lga_poa_table_a %>% filter(LOC_PID %in% c("3000","3001"))
loc_lga_poa_table_b %>% filter(LOC_PID %in% c("3000","3001"))
loc_lga_poa_table_a %>% filter(POA_CODE16 %in% c("3000","3001"))
area_tolerance3 <-set_units(0.3,1)
vic_loc_lga_a <- vic_loc_lga_1 %>% filter(group=="a") %>% select(-ROW_ID,-group,-RELEVANT,-AREA) %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_b <- vic_loc_lga_1 %>% filter(group=="b") %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_a <- vic_loc_lga_1 %>% filter(group=="a") %>% select(-ROW_ID,-group,-RELEVANT,-AREA) %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_b <- vic_loc_lga_1 %>% filter(group=="b") %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
vic_loc_lga_a <- vic_loc_lga_1 %>% filter(group=="a") %>% select(-ROW_ID,-group,-RELEVANT,-AREA) %>%
group_by(LOC_PID,LGA_PID,LGA,LOCALITY) %>%
summarise()
loc_lga_poa_table <- as.data.frame(vic_loc_lga_poa1) %>% select(-geometry) %>%
filter(RELEVANT) %>%
select(LOC_PID,LGA_PID,LOCALITY,LGA,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
arrange(desc(AREA)) %>%
mutate(AREA_REL=AREA/sum(AREA)) %>%
filter(AREA_REL>=area_tolerance3) %>%
mutate(ROW_ID=row_number()) %>%
ungroup()
loc_lga_poa_table1 <- loc_lga_poa_table %>%
group_by(LOC_PID,LGA_PID,LOCALITY,LGA) %>%
summarise(n=n(),.groups = "drop")
loc_lga_poa_table <- loc_lga_poa_table %>%
left_join(loc_lga_poa_table1 %>% select(LOC_PID,LGA_PID,n),
by=c("LOC_PID","LGA_PID"))
loc_lga_poa_table_a <-  vic_loc_lga %>%
left_join (loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_table_b <- vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
select(LOC_PID,LGA_PID,POA_CODE16,n),
by=c("LOC_PID","LGA_PID","POA_CODE16")) %>%
filter(!(n==1))
#check all postcode combinations for manual correctios if necessary
loc_lga_poa_table_b %>% select(POA_CODE16,LOCALITY,RELEVANT) %>%
as.data.frame() %>%  select(-geometry) %>% unique(.)
check <- loc_lga_poa_table_b %>% select(LOCALITY) %>%
as.data.frame() %>%  select(-geometry) %>% unique(.)
View(check)
check <- loc_lga_poa_table_b %>% select(LOC_PID,LOCALITY) %>%
as.data.frame() %>%  select(-geometry) %>% unique(.)
loc_lga_poa_table_b
loc_lga_poa_table_b
loc_lga_poa_table_a
loc_lga_poa_a <-  vic_loc_lga %>%
left_join (loc_lga_poa_table %>%
filter(n==1) %>%
select(LOC_PID,LGA_PID,POA_CODE16),
by=c("LOC_PID","LGA_PID")) %>%
filter(!is.na(POA_CODE16))
loc_lga_poa_b <- vic_loc_lga_poa1 %>%
left_join (loc_lga_poa_table %>%
select(LOC_PID,LGA_PID,POA_CODE16,n),
by=c("LOC_PID","LGA_PID","POA_CODE16")) %>%
filter(!(n==1))
as.dataframe(loc_lga_poa_b) %>%
select(-geometry) %>%
group_by(LOC_PID,LGA_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA_REL)),n=1)
as.data.frame(loc_lga_poa_b) %>%
select(-geometry) %>%
group_by(LOC_PID,LGA_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA_REL)),n=1)
loc_lga_poa_b
as.data.frame(loc_lga_poa_b) %>%
select(-geometry) %>%
group_by(LOC_PID,LGA_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA)),n=1)
as.data.frame(loc_lga_poa_b) %>%
select(LOC_PID,LGA_PID,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA)),n=1)
as.data.frame(loc_lga_poa_b) %>%
select(LGA_PID,POA_CODE16,AREA) %>%
group_by(LOC_PID,LGA_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA)),n=1)
loc_lga_poa_table_c <- as.data.frame(loc_lga_poa_b) %>%
select(LOC_PID,POA_CODE16,AREA) %>%
group_by(LOC_PID,POA_CODE16) %>%
slice_max(order_by=(desc(AREA)),n=1)
View(loc_lga_poa_table_c)
as.data.frame(loc_lga_poa_b) %>%
select(LOC_PID,LOCALITY,POA_CODE16,AREA) %>%
group_by(LOC_PID,LOCALITY,POA_CODE16) %>%
slice_max(order_by=(desc(AREA)),n=1)
as.data.frame(loc_lga_poa_b) %>%
select(LOC_PID,LOCALITY,POA_CODE16,AREA) %>%
group_by(LOC_PID,LOCALITY) %>%
slice_max(order_by=(desc(AREA)),n=1)
