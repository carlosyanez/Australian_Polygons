sl_in_count2 <- sl_in_count %>% count(LOC_PID) %>% filter(n==1)
# check which suburbs are (almost) fully contain in one LGA and add to list
sl_fully_covered <- rbind(sl_fully_covered,
sl_in_count %>% filter(LOC_PID %in% sl_in_count2$LOC_PID)) %>% unique(.)
rm(sl_in_count,sl_in_count2)
sl_fully_covered
sl_fully_covered %>>% count(LOC_PID,LGA_PID) %>% arrange(desc(n))
sl_fully_covered %>% count(LOC_PID,LGA_PID) %>% arrange(desc(n))
sl_in_remnant <-sl_in %>% filter(!(LOC_PID %in% sl_fully_covered)) %>%
mutate(relevant=(area>area_tolerance))
sl_all_revelant <- as.data.frame(sl_in_remnant) %>%
group_by(LOC_PID) %>%
summarise(n=n(),relevant=sum(relevant)) %>%
mutate(diff=n-relevant) %>% filter(diff==0)
sl_mixed <- sl_in_remnant %>% filter(LOC_PID %in% sl_all_revelant$LOC_PID)
sl_mixed %>>% count(LOC_PID,LGA_PID) %>% arrange(desc(n))
sl_mixed %>% count(LOC_PID,LGA_PID) %>% arrange(desc(n))
View(sl_all_revelant)
sl_mixed %>% filter(LOC_PID=="VIC1772")
84887.83>19^4
sl_mixed <- sl_in_remnant %>% filter(LOC_PID %in% sl_all_revelant$LOC_PID & relevant)
sl_mixed %>% filter(LOC_PID=="VIC1772")
area_tolerance
84887.83>10^4
area_tolerance <-10^5
area_tolerance2 <-10^6
sl_in_remnant <-sl_in %>% filter(!(LOC_PID %in% sl_fully_covered)) %>%
mutate(relevant=(area>area_tolerance2))
# check where all areas are relevant
sl_all_revelant <- as.data.frame(sl_in_remnant) %>%
group_by(LOC_PID) %>%
summarise(n=n(),relevant=sum(relevant)) %>%
mutate(diff=n-relevant) %>% filter(diff==0)
# if all areas are relevant, extract (nothing else to do)
sl_mixed <- sl_in_remnant %>% filter(LOC_PID %in% sl_all_revelant$LOC_PID & relevant
sl_mixed %>% filter(LOC_PID=="VIC1772")
sl_mixed %>% filter(LOC_PID=="VIC1772")
sl_in_remnant <-sl_in %>% filter(!(LOC_PID %in% sl_fully_covered)) %>%
mutate(relevant=(area>area_tolerance2))
# check where all areas are relevant
sl_all_revelant <- as.data.frame(sl_in_remnant) %>%
group_by(LOC_PID) %>%
summarise(n=n(),relevant=sum(relevant)) %>%
mutate(diff=n-relevant) %>% filter(diff==0)
# if all areas are relevant, extract (nothing else to do)
sl_mixed <- sl_in_remnant %>% filter(LOC_PID %in% sl_all_revelant$LOC_PID & relevant)
sl_mixed %>% filter(LOC_PID=="VIC1772")
sl_mixed
sl_mixed %>% count(LOC_PID,LGA_PID) %>%arrange(desc(n))
sl_mixed %>% filter(LOC_PID=="VIC500")
plot(sl_mixed %>% filter(LOC_PID=="VIC500" & LGA_PID=="VIC224") %>% select(area))
if(!require(pacman)) install.packages("pacman", repos = "http://cran.us.r-project.org")
#use pacman to install all other packages
pacman::p_load("tidyverse","rgdal","sf","lwgeom","spdep","geojsonsf","rgeos","smoothr",
"rvest","xml2","stringi")
## get list of  councils across state
area_tolerance <-10^4
area_tolerance2 <-10^6
regions <- c("Greater Metropolitan Melbourne","Barwon South West","Grampians",
"Gippsland","Hume","Loddon Mallee")
wiki_page <- read_html("https://en.wikipedia.org/wiki/Local_government_areas_of_Victoria")
clean_lga <-function(df){
df %>%   mutate(LGA=stri_trans_totitle(tolower(LGA)),
LGA=str_remove(LGA,"City of"),
LGA=str_remove(LGA,"Shire of"),
LGA=str_remove(LGA,"Shire"),
LGA=str_remove(LGA,"City"),
LGA=str_remove(LGA,"Rural"),
LGA=str_remove(LGA,"Borough of"),
LGA=str_remove(LGA,"Borough"),
LGA=str_remove(LGA,"\\(Unincorporated\\)"),
LGA=str_remove(LGA,"\\(Uninc\\)"),
LGA=str_squish(LGA),
LGA=str_trim(LGA))
}
#https://gis.stackexchange.com/questions/321281/using-sf-to-combine-polygons-that-share-borders
##special areas - unincorporated regions
uninc_areas <- tribble(~LGA,~State.Region,
"Mount Buller Alpine Resort","Hume",
"Mount Stirling Alpine Resort","Hume",
"Falls Creek Alpine Resort","Hume",
"Lake Mountain Alpine Resort","Hume",
"Mount Hotham Alpine Resort ","Hume",
"Mount Baw Baw Alpine Resort","Gippsland",
"French-Elizabeth-Sandstone Islands","Gippsland"
) %>%
mutate(Metro.Region="Unincorporated",ABB_NAME=toupper(LGA))
### economic areas
#table for melbourne is different....
melb_lgas_list <- wiki_page %>%
html_node(xpath="/html/body/div[3]/div[3]/div[5]/div[1]/table[1]") %>%
html_table(fill = TRUE) %>%
rename(LGA=`Local government area`,
Metro.Region=Region) %>%
clean_lga() %>%
dplyr::select(LGA,Metro.Region) %>%
mutate(ABB_NAME=toupper(LGA),
State.Region=regions[1])
# other regions
lgas_list <- map_dfr(2:6, function(x,regions,wiki_page){
wiki_page %>%
html_node(xpath=str_c("/html/body/div[3]/div[3]/div[5]/div[1]/table[",x,"]")) %>%
html_table(fill = TRUE) %>%
.[!duplicated(as.list(.))] %>%
slice(-1) %>%
rename(LGA=`Local government area`) %>%
clean_lga() %>%
dplyr::select(LGA) %>%
mutate(ABB_NAME=toupper(LGA),
State.Region=regions[x],
Metro.Region="")
},regions,wiki_page)
# put together and clean up
lgas_list <- rbind(lgas_list,melb_lgas_list) %>% rbind(uninc_areas)
rm(regions,melb_lgas_list,wiki_page,uninc_areas)
#Download all shapefiles
## download victorian LGAs
if(!file.exists("VIC_LGA_POLYGON_SHP.shp")){
download.file("https://data.gov.au/data/dataset/bdf92691-c6fe-42b9-a0e2-a4cd716fa811/resource/7b6043d1-76b8-4ea9-b36b-51c61aa740d0/download/vic_lga_polygon_shp.zip",
"LGAs.zip")
unzip("LGAs.zip")
file.remove("LGAs.zip")
}
vic_lga_polygon <- st_read("VIC_LGA_POLYGON_SHP.shp")
## get suburb polygons
if(!file.exists("VIC_LOCALITY_POLYGON_SHP.shp")){
download.file("https://data.gov.au/data/dataset/af33dd8c-0534-4e18-9245-fc64440f742e/resource/3b946968-319e-4125-8971-2a33d5bf000c/download/vic_locality_polygon_shp.zip",
"LGAs.zip")
unzip("LGAs.zip")
file.remove("LGAs.zip")
}
vic_suburb_polygon <- st_read("VIC_LOCALITY_POLYGON_SHP.shp")
#postal areas from ABS
if(!file.exists("POA_2016_AUST.shp")){
download.file("https://www.abs.gov.au/ausstats/subscriber.nsf/log?openagent&1270055003_poa_2016_aust_shape.zip&1270.0.55.003&Data%20Cubes&4FB811FA48EECA7ACA25802C001432D0&0&July%202016&13.09.2016&Previous","pc.zip")
unzip("pc.zip")
file.remove("pc.zip")
}
aus_poas_polygon <- st_read("POA_2016_AUST.shp")
vic_lga_polygon %>% filter(grepl(LGA_NAME,"MORELAND"))
vic_lga_selected <- vic_lga_polygon %>% filter(grepl("MORELAND",LGA_NAME))
vic_lga_selected
a <- st_intersection(vic_suburb_polygon,vic_lga_selected)
a
plot(a)
a %>% st_cast("MULTILINESTRING")
a %>% st_collection_extract("POLYGON")
a <- a %>% st_collection_extract("POLYGON")
plot(a)
View(a)
plot(a %>% filter(NAME="STRATHMORE"))
plot(a %>% filter(NAME=="STRATHMORE"))
a <- a %>% st_cast("MULTILINESTRING")
a
a <- a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING")
a
a <- a %>% mutate(area=st_area(.))
a <- a %>% st_cast("POLYGON") %>% mutate(area=st_area(.))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_cast("POLYGON") %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
plot(a %>% filter(relevant) %>% select(area))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_cast("POLYGON") %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON")
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
st_cast("POLYGON") %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
st_cast("POLYGON") %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
st_cast("POLYGON") %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
st_polygonize() %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>%
st_polygonize() %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
pacman::p_load("tidyverse","rgdal","sf","lwgeom","spdep","geojsonsf","rgeos","smoothr",
"rvest","xml2","stringi","units")
area_tolerance <-set_units(10^4,m^2)
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% set_cast("LINESTRING") %>%
st_polygonize() %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
a <- st_intersection(vic_suburb_polygon,vic_lga_selected) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
View(a)
plot(a %>% filter(relevant) %>% select(area))
vic_loc_lga_1 <- map_df(1:2,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>% mutate(area=st_area(.), relevant=(area>area_tolerance))
},vic_suburb_polygon,vic_lga_polygon)
plot(vic_loc_lga_1 %>% filter(relevant) %>% select(area))
View(vic_loc_lga_1)
vic_loc_lga_1 <- map_df(1:2,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY)) %>%
select(ROW_ID,LOC_PID,LGA_ID,LGA,LOCALITY,AREA,RELEVANT)
)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:2,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
#                                    mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY)) %>%
select(ROW_ID,LOC_PID,LGA_ID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:2,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
#                                    mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY)) %>%
select(LOC_PID,LGA_ID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
View(vic_loc_lga_1)
vic_loc_lga_1 <- map_df(1:1,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
#                                    mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY)) %>%
select(LOC_PID,LGA_ID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:1,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
#                                    mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY)) %>%
select(LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
View(vic_loc_lga_1)
plot(vic_loc_lga_1 %>% filter(relevant) %>% select(area))
plot(vic_loc_lga_1 %>% filter(RELEVANT) %>% select(AREA))
vic_loc_lga_1 <- map_df(1:1,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:1,function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(lga_polygon),function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON") %>%
st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
},vic_suburb_polygon,vic_lga_polygon)
a<- st_intersection(vic_suburb_polygon,vic_lga_polygon[78,]) %>%
st_collection_extract("POLYGON")
vic_lga_polygon[78,]
vic_lga_polygon[78,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,LOCALITY=LGA,ROW_ID=row_number())
vic_lga_polygon[78,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
if(nrow(a==0)){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
vic_lga_polygon[78,]
vic_lga_polygon[78,]
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
nrow(a)
if(nrow(a=1)){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
if(nrow(a==1)){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
nrow(vic_lga_polygon[78,])
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
if(nrow(a)==1){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
if(nrow(a)==1){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
vic_loc_lga_1 <- map_df(1:nrow(vic_lga_polygon),function(x,suburb_polygon,lga_polygon){
message(x)
a <- st_intersection(suburb_polygon,lga_polygon[x,]) %>%
st_collection_extract("POLYGON")
message(nrow(a))
if(nrow(a)==0){
lga_polygon[x,] %>% rename(LGA=LGA_NAME) %>%
clean_lga() %>%
mutate(LOC_PID=LGA_PID,
LOCALITY=LGA,
ROW_ID=row_number(),
AREA=st_area(.),
RELEVANT=TRUE) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}else{
a %>% st_cast("MULTILINESTRING") %>% st_cast("LINESTRING") %>%
st_collection_extract("LINESTRING") %>%
st_polygonize() %>%
mutate(AREA=st_area(.), RELEVANT=(AREA>area_tolerance)) %>%
rename(LGA=LGA_NAME,LOCALITY=NAME) %>%
clean_lga() %>%
mutate(ROW_ID=row_number(), LOCALITY=stri_trans_totitle(tolower(LOCALITY))) %>%
select(ROW_ID,LOC_PID,LGA_PID,LGA,LOCALITY,AREA,RELEVANT)
}
},vic_suburb_polygon,vic_lga_polygon)
plot(vic_loc_lga_1 %>% filter(RELEVANT) %>% select(AREA))
plot(vic_loc_lga_1 %>% filter(RELEVANT & grepl("Moreland",LGA)) %>% select(AREA))
plot(vic_loc_lga_1 %>% filter(RELEVANT & grepl("Moreland|Darebin",LGA)) %>% select(AREA))
plot(vic_loc_lga_1 %>% filter(RELEVANT & grepl("Moreland|Darebin",LGA)) %>% select(AREA)%>% st_snap())
plot(vic_loc_lga_1 %>% filter(RELEVANT & grepl("Moreland|Darebin",LGA)) %>% select(AREA)%>% st_snap())
plot(vic_loc_lga_1 %>% filter(RELEVANT & grepl("Moreland|Darebin",LGA)) %>%  st_snap())
